<div>
  <h1>로그인</h1>
  아이디 : <input type="text" id="signin_email" value="" />
  비밀번호 : <input type="password" id="signin_password" value="" />
  <input type="button" id="signin_submit" value="로그인"  onclick="signin()"/>
</div>
<div>
  <h1>회원가입</h1>
  아이디 : <input type="text" id="signup_email" value="" />
  비밀번호 : <input type="password" id="signup_password" value="" />
  비밀번호 확인 : <input type="password" id="siginup_password_confirm" value="" />
  <input type="button" id="signup_submit" value="회원가입" onclick="signup()"/>
</div>


<script type="text/javascript" charset="utf-8">
  $(function(){
    $("#signin_password").on("keyup",function(e){
      if(e.keyCode == 13){
        $("#signin_submit").click()
      }
    })
    $("#signup_password_confirm").on("keyup",function(e){
      if(e.keyCode == 13){
        $("#signup_submit").click()
      }
    })
  })

  function signin() {
    var email = $("#signin_email").val()
    var password = $("#signin_password").val()
    var check = check_sign_params(email, password)
    if(!check.result){
      alert(check.message)
    }else{
      $.ajax({
        url: "/api/signin/",
        dataType:"JSON",
        type: "POST",
        data: {
          email: email,
          password: password,
        },
        success: function(data) {
          if(data){
            location.reload()
          }else{
            alert("아이디 혹은 비밀번호를 틀렸습니다.")
          }
        }
      })
    }
  }
  function signup() {
    var email = $("#signup_email").val()
    var password = $("#signup_password").val()
    var password_confirm = $("#signup_password_confirm").val()
    var target = $("input[name='signup_target']:checked").val()
    var check = check_sign_params(email, password, password_confirm)
    if(!check.result){
      alert(check.message)
    }else{
      $.ajax({
        url: "/api/signup/",
        dataType:"JSON",
        type: "POST",
        data: {
          email: email,
          password: password,
          target: target
        },
        success: function(data) {
          if(data.result){
            location.reload()
          }else{
            alert(data.message)
          }
        }
      })
    }
  }
  function check_sign_params(email, password, password_confirm) {
    if(password_confirm == null){
      password_confirm = password
    }
    ret = new Object
    ret.result = true
    if(!validateEmail(email)){
      ret.result = false
      ret.message ="이메일을 잘못 입력하셨습니다."
    }else if(password.length < 8){
      ret.result = false
      ret.message ="비밀번호의 길이가 짧습니다."
    }else if(password != password_confirm){
      ret.result = false
      ret.message = "비밀번호와 비밀번호 재입력이 일치하지 않습니다."
    }
    return ret
  }


  function validateEmail(email) {
      var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
      return re.test(email);
  }
</script>

